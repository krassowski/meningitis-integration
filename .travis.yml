dist: bionic
language: python
cache:
  - pip
  - packages
if: tag IS present

python:
  - 3.7

before_install:
  - sudo sh -c 'echo "deb https://cloud.r-project.org/bin/linux/ubuntu bionic-cran35/" >> /etc/apt/sources.list'
  - sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E084DAB9

install:
  - bash setup.sh

script:
  - nbpipeline --definitions_file pipeline.py

#before_deploy:
#  # Set up git user name and tag this commit
#  - git config --local user.name "krassowski"
#  - git config --local user.email "krassowski.michal@gmail.com"
#  - export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
#  - git tag $TRAVIS_TAG

deploy:
  provider: releases
  api_key: "$GITHUB_API_KEY"
  file: "/tmp/graph.html"
  skip_cleanup: true
  draft: true

