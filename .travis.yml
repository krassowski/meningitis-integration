dist: bionic
language: python
if: tag IS present
cache:
  - apt: true
  - directories:
    - $HOME/.cache/pip
    - $HOME/R_lib"

python:
  - 3.7

before_install:
  - bash install_R.sh

install:
  - while sleep 9m; do echo "$SECONDS seconds"; done &
  - export MAKE='make -j 2'
  - export R_LIBS="~/R_lib"
  - R_LIBS_USER="$HOME/R_lib:$R_LIBS_USER" bash setup.sh
  - kill %1

script:
  - nbpipeline --definitions_file pipeline.py

deploy:
  provider: releases
  api_key: "$GITHUB_API_KEY"
  file: "/tmp/graph.html"
  skip_cleanup: true
  draft: true

